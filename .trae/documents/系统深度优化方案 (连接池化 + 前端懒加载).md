# 系统性能深度优化方案 (V5.3)

基于上一轮的性能分析与基础优化，我们已解决了最核心的架构问题。现在的目标是**消除剩余的瓶颈**，进一步提升系统的稳定性和用户体验。

## 1. 后端稳定性与并发 (Backend Concurrency & Stability)
*   **痛点**: `src/workflow/graph.py` 中使用了**全局单例且非线程安全**的 `pymysql` 连接用于状态持久化 (`MySQLSaver`)。
    *   **风险**: 在高并发下，多个请求同时使用同一个连接会导致数据错乱或连接断开。
*   **优化**: 引入连接池 (`SQLAlchemy Pool`) 来管理 `MySQLSaver` 的连接，确保线程安全。
*   **痛点**: `ExecuteSQL` 节点在执行查询时未强制限制行数，可能导致内存溢出 (OOM)。
*   **优化**: 增加默认的 `LIMIT 1000` 保护，仅在明确需要全量导出时才放开。

## 2. 前端加载速度与渲染 (Frontend Performance)
*   **痛点**: `App.tsx` 中所有页面组件都是**静态导入**的。这意味着用户即使只访问登录页，也会下载包含 ECharts、Monaco Editor 等重型库的完整 Bundle。
*   **优化**: 使用 `React.lazy` 和 `Suspense` 实现**路由懒加载 (Code Splitting)**，首屏体积预计可减少 40% 以上。
*   **痛点**: `ChatWindow.tsx` 在接收流式消息时，Markdown 和代码高亮组件会频繁重绘。
*   **优化**: 使用 `React.memo` 优化消息列表项，减少不必要的 DOM Diff。

---

## 实施计划

### 1. 后端：连接池化改造
*   **目标**: `src/workflow/graph.py`
*   **动作**: 替换 `pymysql.connect` 为 `sqlalchemy.create_engine(...).pool`。

### 2. 后端：内存保护
*   **目标**: `src/workflow/nodes/execute.py`
*   **动作**: 在执行 SQL 前检查并注入 `LIMIT` 子句（如果缺失）。

### 3. 前端：路由懒加载
*   **目标**: `frontend/src/App.tsx`
*   **动作**: 将 `import ChatPage ...` 改为 `const ChatPage = lazy(() => import(...))`。

### 4. 前端：渲染优化
*   **目标**: `frontend/src/components/ChatWindow.tsx`
*   **动作**: 抽离 `MessageItem` 组件并包裹 `memo`。
