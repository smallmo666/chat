# 系统深度优化方案 (V6.0) - 可观测性与稳定性

基于 `docs/OPTIMIZATION_ROADMAP.md` 的 Phase 3 和代码现状分析，本轮优化将重点放在系统的 **可观测性 (Observability)** 和 **稳定性 (Stability)** 上。这将使我们能够实时监控系统的健康状况，快速定位性能瓶颈，并为未来的优化提供数据支持。

## 1. 启用全链路追踪 (Tracing)
*   **痛点**: 目前后端 API 和 LangGraph 内部的执行过程是“黑盒”，难以调试 Token 消耗、耗时分布和错误根因。
*   **方案**:
    1.  在 `src/api/app.py` 中**启用 Arize Phoenix** 追踪。它能自动捕获 LangChain/LangGraph 的每一步执行详情、Prompt 内容和 LLM 响应。
    2.  配置 Phoenix 的本地服务，使其随应用启动。

## 2. 增强前端用户体验 (UI/UX)
*   **痛点**: 前端控制台报出 `[antd: Spin] tip only work in nest or fullscreen pattern` 警告。
*   **方案**: 修复 `frontend/src/App.tsx` 中的 `LoadingFallback` 组件，正确使用 Ant Design 的 `Spin` 组件（包裹在容器中或使用全屏模式）。

## 3. 增强测试覆盖率 (Testing)
*   **痛点**: 虽然有评估脚本，但缺乏对核心 API 接口的自动化集成测试，容易因改动导致 API 契约破坏。
*   **方案**: 创建 `scripts/test_api_endpoints.py`，使用 `pytest` 和 `httpx` 对主要 API 端点（`/api/chat/*`, `/api/project/*`）进行连通性和基本功能测试。

## 4. 环境与依赖管理 (Infrastructure)
*   **痛点**: `docker-compose.yml` 中缺少 Phoenix 服务定义。
*   **方案**: 在 `docker-compose.yml` 中添加 Phoenix 服务（通常运行在 6006 端口），以便在 Docker 环境下也能查看追踪。

---

## 实施计划

### 1. 启用 Phoenix 追踪
*   **目标**: `src/api/app.py`
*   **动作**: 取消相关代码注释，确保 Phoenix Instrumentor 在应用启动时加载。

### 2. 修复前端 Spin 警告
*   **目标**: `frontend/src/App.tsx`
*   **动作**: 优化 `LoadingFallback` 的实现。

### 3. 添加 API 集成测试
*   **目标**: `scripts/test_api_endpoints.py` (新文件)
*   **动作**: 编写测试脚本，验证 API 健康检查、项目列表和简单的对话接口。

### 4. 更新 Docker Compose
*   **目标**: `docker-compose.yml`
*   **动作**: 添加 `phoenix` 服务配置。
