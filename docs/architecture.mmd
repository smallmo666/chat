graph TD
    %% Access Layer
    subgraph Client ["ğŸ’» Client (Access Layer)"]
        Web["React Frontend"]
        CLI["Command Line"]
    end

    %% API Gateway
    subgraph Gateway ["ğŸšª API Gateway"]
        FastAPI["FastAPI Server"]
        SSE["SSE Streamer"]
        Auth["JWT Auth"]
    end

    %% Orchestration
    subgraph Orchestration ["ğŸ§  Orchestration (LangGraph Swarm)"]
        Supervisor["ğŸ‘¨â€âœˆï¸ Supervisor"]
        Planner["ğŸ“ Planner"]
        CacheCheck["ğŸ§  Cache Check"]
        DataDetective["ğŸ•µï¸â€â™‚ï¸ Data Detective"]
        Knowledge["ğŸ“š Knowledge Retrieval"]
        
        subgraph SQL_Pipeline ["SQL Pipeline"]
            Clarify["ğŸ—£ï¸ Clarify Intent"]
            SelectTables["ğŸ“‹ Select Tables"]
            GenDSL["ğŸ› ï¸ Generate DSL"]
            DSL2SQL["ğŸ”„ DSL to SQL"]
            ExecuteSQL["ğŸš€ Execute SQL"]
            CorrectSQL["ğŸ”§ Correct SQL"]
        end
        
        subgraph Analysis_Pipeline ["Analysis Pipeline"]
            Insight["ğŸ’¡ Insight Miner"]
            PyAnalysis["ğŸ“Š Python Analyst"]
            Viz["ğŸ“ˆ Visualization"]
            VizAdvisor["ğŸ§­ Viz Advisor"]
            TableQA["ğŸ’¬ Table QA"]
        end
        
        subgraph UX_Pipeline ["UX Pipeline"]
            Artist["ğŸ¨ UI Artist"]
        end
        
        CacheCheck -->|Miss| DataDetective & Knowledge
        CacheCheck -->|Hit| Supervisor
        DataDetective --> Planner
        Knowledge --> Planner
        Planner --> Supervisor
        
        Supervisor --> Clarify & SelectTables & GenDSL & DSL2SQL & ExecuteSQL & TableQA & Viz & VizAdvisor & PyAnalysis & Insight & Artist
        
        ExecuteSQL -->|Error| CorrectSQL
        CorrectSQL --> ExecuteSQL
        
        Clarify & SelectTables & GenDSL & DSL2SQL & ExecuteSQL & TableQA & Viz & VizAdvisor & PyAnalysis & Insight & Artist --> Supervisor
    end

    %% Core Capabilities
    subgraph Core ["âš™ï¸ Core Capabilities"]
        RAG["ğŸ“š Schema RAG"]
        Sandbox["ğŸ“¦ Python Sandbox"]
        SemanticCache["ğŸ§  Semantic Cache"]
        Privacy["ğŸ›¡ï¸ Privacy Filter"]
    end

    %% Data Infrastructure
    subgraph Data ["ğŸ’¾ Data Infrastructure"]
        MetaData[("MySQL/SQLite Metadata")]
        BusinessDB[("Business Database")]
        VectorDB[("FAISS VectorDB")]
        Redis[("Redis Cache")]
    end

    %% Relationships
    Client <-->|HTTP/SSE| Gateway
    Gateway <-->|Invoke| Orchestration
    
    Orchestration <--> SemanticCache
    Orchestration <--> RAG
    
    ExecuteSQL -->|Query| BusinessDB
    PyAnalysis <--> Sandbox
    Sandbox -->|Process| BusinessDB
    
    BusinessDB --> Privacy --> Orchestration
    
    style Supervisor fill:#ff9900,stroke:#333,stroke-width:2px
    style BusinessDB fill:#336699,stroke:#333,stroke-width:2px
    style Sandbox fill:#66cc66,stroke:#333,stroke-width:2px
